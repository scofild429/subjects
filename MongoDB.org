#+TITLE:  MongoDB
#+OPTIONS: num:nil
#+SETUPFILE: https://fniessen.github.io/org-html-themes/setup/theme-readtheorg.setup
#+startup: overview

* open the mongodb service


|-------------+-----------|
| commonds    | functions |
|-------------+-----------|
| or          | $inc      |
| in          | $mul      |
| exist       | $rename   |
| gl          | $set      |
| sort        | $unset    |
| limit       |           |
| skip        |           |
| /x/         |           |
| /^x/        |           |
| upsert      |           |
| rename      |           |
| getIndexs   |           |
| createIndex |           |
| dropIndex   |           |
|             |           |


#+begin_src sh :dir /sudo::
sudo systemctl start mongod
#+end_src





* operation

** create database, collections, and drops 
:admin  at the first step, we must login into one  database

#+begin_src mongo  :db admin
  show dbs;
  use xiaoma;
  db.createCollection("posts");
  show collections;
  db.posts.drop();
  db.dropDatabase();
#+end_src


** create database, collections, and documents

#+begin_src mongo  :db admin
  use xiaoma;
  db.createCollection("posts");
  show collections;

  db.posts.insert({ 
      title: "my first blog",
      content: "can be start"
  });
  db.posts.insert({ 
      title: "my second blog",
      content: "can be start now",
      tag: ["unknow type"]
  });

  for(var i = 3;i<=10;i++){
      db.posts.insert( {title :"this is my "+i+"th blog"});
  };
  db.posts.find();
  db.posts.count();
  db.posts.remove({});
  db.posts.drop();
  db.dropDatabase();
#+end_src

* backup and restore
mongo xiaoma  : can just get in xiaoma database

** 01, create documents
#+begin_src mongo :db admin
  use xiaoma;
  db.createCollection("posts");
  show collections;

  db.posts.insert({ 
      title: "my first blog",
      content: "can be start"
  });
  db.posts.insert({ 
      title: "my second blog",
      content: "can be start now",
      tag: ["unknow type"]
  });

  for(var i = 3;i<=10;i++){
      db.posts.insert( {title :"this is my "+i+"th blog"});
  };

  db.posts.find();
  db.posts.count();

#+end_src


** 02, dump
#+begin_src sh
  cd ~/Desktop/
  mkdir mongobk
  cd mongobk
  mongodump -d xiaoma

#+end_src



** 03, delete documents
#+begin_src mongo :db admin
  use xiaoma;
  db.posts.remove({});
  db.posts.find();
  exit;
#+end_src



** 04, restore
#+begin_src sh
cd ~/Desktop/mongobk
mongorestore --drop
#+end_src


** 05, check
#+begin_src mongo :db admin
  use xiaoma;
  db.posts.find();
  db.posts.drop();
  db.dropDatabase();
#+end_src




